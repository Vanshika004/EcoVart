{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Vanshika/Desktop/Ecocart/lib/orders.js"],"sourcesContent":["// lib/orders.js\r\nimport {\r\n  collection,\r\n  addDoc,\r\n  serverTimestamp,\r\n  query,\r\n  where,\r\n  orderBy,\r\n  getDocs,\r\n} from \"firebase/firestore\";\r\nimport { db } from \"./firebase\";\r\n\r\n// Place user's order\r\nexport async function placeOrderForUser(uid, orderPayload) {\r\n  if (!uid) throw new Error(\"Missing uid\");\r\n\r\n  const ordersCol = collection(db, \"orders\");\r\n\r\n  const payload = {\r\n    userId: uid,\r\n    items: Array.isArray(orderPayload.items) ? orderPayload.items : [],\r\n    total: orderPayload.total || 0,\r\n    footprintEstimate: orderPayload.footprintEstimate || null,\r\n    status: \"placed\",\r\n    createdAt: serverTimestamp(),\r\n  };\r\n\r\n  const ref = await addDoc(ordersCol, payload);\r\n  return { id: ref.id, data: payload };\r\n}\r\n\r\n// Fetch user's orders\r\nexport async function fetchOrdersForUser(uid) {\r\n  if (!uid) return [];\r\n\r\n  const q = query(\r\n    collection(db, \"orders\"),\r\n    where(\"userId\", \"==\", uid),\r\n    orderBy(\"createdAt\", \"desc\")\r\n  );\r\n\r\n  const snaps = await getDocs(q);\r\n  return snaps.docs.map((d) => ({ id: d.id, data: d.data() }));\r\n}\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAChB;AASA;;;;;;;;AAGO,eAAe,kBAAkB,GAAG,EAAE,YAAY;IACvD,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAE1B,MAAM,YAAY,IAAA,wJAAU,EAAC,8GAAE,EAAE;IAEjC,MAAM,UAAU;QACd,QAAQ;QACR,OAAO,MAAM,OAAO,CAAC,aAAa,KAAK,IAAI,aAAa,KAAK,GAAG,EAAE;QAClE,OAAO,aAAa,KAAK,IAAI;QAC7B,mBAAmB,aAAa,iBAAiB,IAAI;QACrD,QAAQ;QACR,WAAW,IAAA,6JAAe;IAC5B;IAEA,MAAM,MAAM,MAAM,IAAA,oJAAM,EAAC,WAAW;IACpC,OAAO;QAAE,IAAI,IAAI,EAAE;QAAE,MAAM;IAAQ;AACrC;AAGO,eAAe,mBAAmB,GAAG;IAC1C,IAAI,CAAC,KAAK,OAAO,EAAE;IAEnB,MAAM,IAAI,IAAA,mJAAK,EACb,IAAA,wJAAU,EAAC,8GAAE,EAAE,WACf,IAAA,mJAAK,EAAC,UAAU,MAAM,MACtB,IAAA,qJAAO,EAAC,aAAa;IAGvB,MAAM,QAAQ,MAAM,IAAA,qJAAO,EAAC;IAC5B,OAAO,MAAM,IAAI,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;YAAE,IAAI,EAAE,EAAE;YAAE,MAAM,EAAE,IAAI;QAAG,CAAC;AAC5D"}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Vanshika/Desktop/Ecocart/pages/cart.js"],"sourcesContent":["import { useContext, useState } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { AuthContext } from \"./_app\";\r\nimport Link from \"next/link\";\r\nimport { saveCartForUser, clearCartForUser } from \"../lib/cart\";\r\nimport { placeOrderForUser } from \"../lib/orders\";\r\n\r\nexport default function CartPage() {\r\n  const { user, cart, setCart } = useContext(AuthContext); // cart and setter from context\r\n  const [loading, setLoading] = useState(false);\r\n  const router = useRouter();\r\n\r\n  const items = cart?.items || [];\r\n\r\n  const subtotal = items.reduce((s, it) => s + it.price * (it.qty || 1), 0);\r\n\r\n  async function handleQuantityChange(index, newQty) {\r\n    const newItems = items.slice();\r\n    newItems[index] = { ...newItems[index], qty: newQty };\r\n    // update local UI immediately\r\n    setCart({ items: newItems });\r\n\r\n    try {\r\n      if (user) {\r\n        await saveCartForUser(user.uid, { items: newItems });\r\n      } else {\r\n        localStorage.setItem(\r\n          \"ecocart_cart\",\r\n          JSON.stringify({ items: newItems })\r\n        );\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Failed to save cart:\", err);\r\n      // optionally show a toast - fallback to localStorage\r\n      localStorage.setItem(\"ecocart_cart\", JSON.stringify({ items: newItems }));\r\n    }\r\n  }\r\n\r\n  async function handleRemove(index) {\r\n    const newItems = items.slice();\r\n    newItems.splice(index, 1);\r\n    // update UI\r\n    setCart({ items: newItems });\r\n\r\n    try {\r\n      if (user) {\r\n        await saveCartForUser(user.uid, { items: newItems });\r\n      } else {\r\n        localStorage.setItem(\r\n          \"ecocart_cart\",\r\n          JSON.stringify({ items: newItems })\r\n        );\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Failed to update cart on remove:\", err);\r\n    }\r\n  }\r\n\r\n  async function handlePlaceOrder() {\r\n    if (!user) {\r\n      router.push(\"/auth\");\r\n      return;\r\n    }\r\n    if (!items.length) return;\r\n    setLoading(true);\r\n    try {\r\n      const orderPayload = {\r\n        items,\r\n        total: subtotal,\r\n        footprintEstimate: null,\r\n      };\r\n      await placeOrderForUser(user.uid, orderPayload);\r\n      // clear cart in Firestore and local UI\r\n      await clearCartForUser(user.uid);\r\n      setCart({ items: [] });\r\n      router.push(\"/orders\");\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"Failed to place order: \" + (err.message || err));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  if (!items.length) {\r\n    return (\r\n      <div className=\"max-w-4xl mx-auto p-8 text-center\">\r\n        <h2 className=\"text-2xl font-semibold mb-4\">Your cart is empty</h2>\r\n        <Link\r\n          href=\"/shop\"\r\n          className=\"inline-block bg-green-600 text-white px-4 py-2 rounded-md\"\r\n        >\r\n          Continue shopping\r\n        </Link>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n      <div className=\"lg:col-span-2 space-y-4\">\r\n        {items.map((it, idx) => (\r\n          <div\r\n            key={idx}\r\n            className=\"p-4 bg-white rounded-lg shadow flex items-center gap-4\"\r\n          >\r\n            <img\r\n              src={it.image}\r\n              className=\"w-28 h-28 object-cover rounded-md\"\r\n              alt={it.name}\r\n            />\r\n            <div className=\"flex-1\">\r\n              <h3 className=\"font-semibold text-lg\">{it.name}</h3>\r\n              <div className=\"text-sm text-gray-500 mt-1\">₹{it.price}</div>\r\n              <div className=\"mt-3 flex items-center gap-3\">\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"1\"\r\n                  value={it.qty || 1}\r\n                  onChange={(e) =>\r\n                    handleQuantityChange(\r\n                      idx,\r\n                      Math.max(1, Number(e.target.value))\r\n                    )\r\n                  }\r\n                  className=\"w-20 border rounded px-3 py-1\"\r\n                />\r\n                <button\r\n                  onClick={() => handleRemove(idx)}\r\n                  className=\"text-sm text-red-500 hover:underline\"\r\n                >\r\n                  Remove\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <aside className=\"bg-white p-6 rounded-lg shadow\">\r\n        <h3 className=\"font-semibold text-lg\">Order Summary</h3>\r\n        <div className=\"mt-4 space-y-3\">\r\n          <div className=\"flex justify-between text-sm\">\r\n            <span>Subtotal</span>\r\n            <strong>₹{subtotal}</strong>\r\n          </div>\r\n          <div>\r\n            <button\r\n              disabled={loading}\r\n              onClick={handlePlaceOrder}\r\n              className=\"w-full bg-green-600 text-white rounded-md px-4 py-2 disabled:opacity-50\"\r\n            >\r\n              {loading ? \"Placing order...\" : \"Place Order\"}\r\n            </button>\r\n          </div>\r\n          <div className=\"text-xs text-gray-500\">\r\n            Secure checkout · Estimated delivery in 5-7 days\r\n          </div>\r\n        </div>\r\n      </aside>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}